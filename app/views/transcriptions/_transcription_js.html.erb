<script type="text/javascript">


function transcribeData(event, $form) {
    event.preventDefault();/*supress default submit action of refreshing the page, so we can add more than one annoation to the
    transcription */

    $form.unbind("ajax:success");
    $form.on("ajax:success", function(e, data, status, xhr) {
        // console.log(e);
        // console.log(data);
        // console.log(status);
        // console.log(xhr);

        $('#scribe_annotation_box').hide();

        if (data.id == null) {
          TranscriberApp.AppManager.setMsg("Annotation could not be saved because the ID returned was null", false, "danger");
          return;
        }
        TranscriberApp.AppManager.setMsg("Annotation sucessfully saved! Click and drag a box around the area that you just transcribed", false, "info");

        $("#page-container").kinetic("detach");

        $form.unbind("ajax:success");
        $form.on("ajax:success", function(e, status, data, xhr) {
            // console.log(e);
            // console.log(data);
            // console.log(status);
            // console.log(xhr);

            TranscriberApp.AppManager.setMsg("Annotated region sucessfully saved!", true, "success");

            $("[data-selectable='true'").val(null).trigger("change");
        });
        $form.attr("method", "put");
        $form.attr("action", ("/annotations/" + data.id));


        // Using the boxer plugin
        $('#canvas').boxer({
          appendTo: "#canvas",
          container : "#page-container",
          groupColour : data.field_group.colour_class,

          stop: function(event, ui) {

            var offset = ui.box.offset();
              var position = {
                x: offset.left - $(document).scrollLeft() - $("#canvas").offset().left,
                y : offset.top - $(document).scrollTop() - $("#canvas").offset().top
              };
              ui.box.attr('id',('annotation-' + data.id)).attr('data-annotation-id', data.id).attr('data-field-group-id', data.field_group.id)

              ui.box.html(annotationBoxContents(data.id));

              $form.find("#x-field").val(position.x);
              $form.find("#y-field").val(position.y);
              $form.find("#width-field").val(ui.box.width());
              $form.find("#height-field").val(ui.box.height());

              $('#canvas').unbind(".boxer");
              $("#page-container").kinetic("attach");
              $form.submit();
              $form.find(".observation-input").not(".do-not-clear").val('');
          }
        });

    }).on("ajax:error", function(e, xhr, status, error) {
        // console.log(e);
        console.log(error);
        console.log(status);
        // console.log(xhr);
        TranscriberApp.AppManager.setMsg("Annotation could not be saved because: " + error + " | " + status, true, "danger");
    });

    $form.submit();
  }


</script>
