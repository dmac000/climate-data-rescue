<script type="text/javascript">
$(document).ready(function(){
//Javascript for custom functionality on new transcription page. 
//All javascript written by the author unless otherwise credited. 
//Code credited as "sourced from" have been modified little to none. 
//Code credited as "adapted from" uses ideas and some lines from the credited location while modifying them to work with this project


  $('.transcription_form').submit(function(event) {
    event.preventDefault();/*supress default submit action of refreshing the page, so we can add more than one annoation to the 
    transcription */
    $('#scribe_annotation_box').hide();
    
  });

//function to toggle between field group form layers when you click on their respective tab. Marks current tab as active
  $(".scribe_tab").click(function(){ /* perform function when user click on an element with the "scribe_tab" class. Corresponds 
  to Field Group tabs in the transcription box */
     $tab = $(this);
     $(".transcription_form").hide(); //hide all other instances of the field_group data forms when switching tabs
     $('#formInstructions').hide();
     $tab.addClass("scribe_selected_tab"); //mark clicked tab as active by settings its class
     // $('#currentForm').removeAttr('id', 'currentForm'); //remove the ID 'currentForm' from whichever element currently has it
     // $('#' + $(this).attr("divId")).parents('form').attr('id', 'currentForm');//mark form associated with the clicked tab as 'currentForm'

     $tab.siblings().removeClass('scribe_selected_tab'); //set all siblings of the clicked tab as unselected
     
     var $currentForm = $("form#" + $tab.data('form-id'));
     $currentForm.show();

     //console.log('success'); 
  });
//end field toggler

//open transcription box at page image mouse click position
  $("#target-image").click(function(e){
     $("#scribe_annotation_box").show(500); /*open the box with a delay of half a second. This is what makes the transcription 
     box open with a flourish. Remove the value from the .show() function to make it open instantly */
     $("#scribe_annotation_box").offset({left:e.pageX,top:e.pageY}); //set position of the box to open at the click event 'e' position
     $("#scribe_zoom_box").css("background-position-x", (-1 * e.pageX));
  });
//end transcription box toggle
});
/*function to enable the image zoom box. Adapted from http://thecodeplayer.com/walkthrough/magnifying-glass-for-images-using-jquery-and-css3 and http://jsfiddle.net/aasFx/ */
  $(document).ready(function(){
      var native_width = 0;
      var native_height = 0;

      var image_object = new Image();
      image_object.src = $("#target-image").attr("src");

      //This code is wrapped in the .load function which is important.
      //width and height of the object would return 0 if accessed before 
      //the image gets loaded.
      native_width = image_object.width;
      native_height = image_object.height;

      // console.log(image_object);

      $("#scribe_annotation_box").draggable({
          containment: "#magnify",
          scroll: false,
          drag: function(){
            var $this = $(this);
            var $baseImage = $("#target-image");
            var $box = $("#scribe_zoom_box");
            var bgpY = $box.css("background-position-y");

            var baseWidth = $baseImage.width();
            var boxWidth = $box.width();

            var boxBaseRatio = Math.round(baseWidth / boxWidth);
            var imageZoomRatio = Math.round(native_width / baseWidth);
            var thisPos = $this.position();
            var basePos = $baseImage.position();

            var dX = basePos.left - thisPos.left;
            // console.log("x-diff: " + dX + ", y-diff: " + dY);
            
            //The background position of scribe_zoom_box will be changed according to the position
            //of the mouse over the #baseImage image. So we will get the ratio of the pixel
            //under the mouse pointer with respect to the image and use that to position the 
            //large image inside the zoom box
            // var rx = (Math.round(mx/$base.width()*native_width + ($base.width()/2) - $zoom.width()/2)*-1)-150;
            // var ry = (Math.round(my/$base.height()*native_height + ($base.height()/2) - $zoom.height()/2))*-1;
            
            var rX = Math.round(dX);

            var bgp = dX + "px " + bgpY;
            // //If you move the box over the image now, you should see the zoom box in action
            $box.css("background-position", bgp);
          }
      });
      
      $("#scribe_zoom_box").mousedown(function(e) {
          $("#scribe_annotation_box").draggable("disable");
          var $box = $(this);
          var clickY = e.pageY;
          var bgp = $box.css("background-position-y");
          var bY = parseInt(bgp.slice(0,bgp.length - 2));
          $(window).mousemove(function(e) {
             var y = e.pageY;
             var dY = clickY - y;
             var bgpNew = bY - dY;
             $box.css("background-position-y", bgpNew);
          });
      }).mouseup(function() {
          $(window).unbind("mousemove");
          $("#scribe_annotation_box").draggable("enable");
      });
      
  });
//end image zoom box

</script>